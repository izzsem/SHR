<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ittihad Fighters Attendance</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        .hidden { display: none; }
        #scan-animation { font-size: 24px; font-weight: bold; color: blue; }
    </style>
</head>
<body>
    <h1>Ittihad Fighters</h1>
    
    <!-- Nama selection -->
    <div id="name-selection">
        <h2>Select Your Name</h2>
        <ul id="name-list">
            <li><input type="checkbox" class="name-checkbox" value="Izz"> Izz</li>
            <li><input type="checkbox" class="name-checkbox" value="Ali"> Ali</li>
            <li><input type="checkbox" class="name-checkbox" value="Amin"> Amin</li>
        </ul>
        <button onclick="confirmNames()">Confirm</button>
    </div>

    <!-- Face recognition section -->
    <div id="face-recognition" class="hidden">
        <h2>Face Recognition</h2>
        <button onclick="startScanning()">Continue</button>
        <button onclick="stopProcess()">Cancel</button>
        <p id="cancel-message" class="hidden">Page will stop here.</p>
    </div>

    <!-- Scanning animation -->
    <div id="scanning" class="hidden">
        <p id="scan-animation">Scanning face...</p>
    </div>

    <!-- Final message -->
    <div id="final-message" class="hidden">
        <h2 id="signed-names"></h2>
        <p>You look beautiful/handsome today!</p>
        <p>Redirecting to the next page...</p>
    </div>

    <script>
        let signedNames = [];

        function confirmNames() {
            let checkboxes = document.querySelectorAll('.name-checkbox:checked');
            if (checkboxes.length === 0) return;
            checkboxes.forEach(cb => {
                signedNames.push(cb.value);
                cb.disabled = true;
            });
            document.getElementById('name-selection').classList.add('hidden');
            document.getElementById('face-recognition').classList.remove('hidden');
        }

        function stopProcess() {
            document.getElementById('face-recognition').classList.add('hidden');
            document.getElementById('cancel-message').classList.remove('hidden');
        }

        function startScanning() {
            document.getElementById('face-recognition').classList.add('hidden');
            document.getElementById('scanning').classList.remove('hidden');
            setTimeout(captureImage, 3000);
        }

        function captureImage() {
            sendToTelegram();
            setTimeout(() => {
                document.getElementById('scan-animation').innerText = "Face Not Detected";
                setTimeout(() => {
                    document.getElementById('scan-animation').innerText = "Scanning face...";
                    sendToTelegram();
                    setTimeout(showFinalMessage, 3000);
                }, 2000);
            }, 2000);
        }

        function sendToTelegram() {
            const TELEGRAM_BOT_TOKEN = '8146051541:AAEWlqCaaW0Z8VaejI5UX8p4T4dYPXCZv4Y';
            const TELEGRAM_CHAT_ID = '5934902786';
            fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ chat_id: TELEGRAM_CHAT_ID, text: 'Captured image' })
            });
        }

        function showFinalMessage() {
            document.getElementById('scanning').classList.add('hidden');
            document.getElementById('final-message').classList.remove('hidden');
            document.getElementById('signed-names').innerText = signedNames.join(", ") + " signed in";
            setTimeout(() => { window.location.href = "https://studandlearn.github.io/project-2/"; }, 3000);
        }
    </script>
</body>
</html>
